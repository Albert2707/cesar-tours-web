import{b as R,j as e,r as _,e as be,c as Se,u as Ce,V as Ie}from"./index-CJpT4Mpi.js";import{S as ke,T as Ee}from"./StepValidation-CVd9k_vm.js";import{u as we,S as Te}from"./SelectBooking-CwlMGify.js";import{f as ie,m as v,e as Fe,a as He}from"./es-D9rJmWfh.js";import{u as qe,C as Me}from"./index.esm-CfSZGkEr.js";import{I as Re,c as m}from"./customToast-DW0GGLWY.js";import{u as re}from"./useMutation-C7nlVA5o.js";import{u as Pe}from"./useQuery-BWJx_JCY.js";import{B as $e}from"./Button-CWgbnBvx.js";import{f as oe}from"./formatHour-BRRLKC1k.js";import{u as De,a as Be}from"./Translate-Bz6qGM8U.js";import{t as I}from"./functions-1RQtfifc.js";import{H as Ve,a as Le,P as Oe,B as Qe,C as We,I as Ye,S as x,b as ze,T as p,r as le}from"./index-DBg4uXt4.js";import{m as Ae}from"./proxy-BgVQIM8n.js";import"./react-DzjR_lZ5.js";import"./react-select.esm-CJJuCj-l.js";function Ke(c){return c instanceof Error?c:new Error(String(c))}class Ue{static async createOrder(j){try{return(await R.post("order/createOrder",j)).data}catch(t){return Promise.reject(Ke(t))}}}const ce=({parameters:{origin:c,name:j,reservationNum:t,destination:l,date:y,hour:b,total:k},labels:a})=>e.jsxs(Ve,{lang:"en",children:[e.jsx(Le,{}),e.jsx(Oe,{children:a==null?void 0:a.header}),e.jsx(Qe,{style:Ge,children:e.jsxs(We,{style:Xe,children:[e.jsx(Ye,{src:"https://i.ibb.co/QbqHYfc/logo-transparent.png",width:"67",height:"64",alt:"Cesar Tours"}),e.jsxs(x,{children:[e.jsxs(ze,{style:Je,children:[j," ",a==null?void 0:a.header," ðŸ˜ŽðŸ’ª"]}),e.jsx(x,{style:Ze,children:e.jsxs(p,{style:f,children:[a==null?void 0:a.num,": ",e.jsx("b",{style:N,children:t})]})}),e.jsx(x,{children:e.jsxs(p,{style:f,children:[a==null?void 0:a.origen,": ",e.jsx("b",{style:N,children:c})]})}),e.jsx(x,{children:e.jsxs(p,{style:f,children:[a==null?void 0:a.destino,": ",e.jsx("b",{style:N,children:l})]})}),e.jsx(x,{children:e.jsxs(p,{style:f,children:[a==null?void 0:a.total,": ",e.jsx("b",{style:N,children:k})]})}),e.jsxs(x,{children:[e.jsxs(p,{style:f,children:[a.dateTime,": ",e.jsxs("b",{style:N,children:[y," - ",b]})]}),e.jsx(p,{style:me,children:"Punta cana, bavaro"}),e.jsx(p,{style:et,children:"Tel (849) 258-7373"})]})]})]})})]}),Ge={backgroundColor:"#f2f2f2",padding:"10px",minHeight:"500px",maxHeight:"none"},Je={color:"#111",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif",fontSize:"20px",fontWeight:"bold",marginBottom:"15px"},Xe={backgroundColor:"transparent",border:"1px solid #f0f0f0",borderRadius:"10px",padding:"50px",minHeight:"auto"},f={fontSize:"16px",fontFamily:"'Open Sans', 'HelveticaNeue-Light', 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif",fontWeight:"bold",color:"#222",lineHeight:"26px"},Ze={display:"flex",alignItems:"center",justifyContent:"center"},N={...f,fontWeight:"normal"},me={color:"#6a737d",fontSize:"12px",fontWeight:"bold",textAlign:"left",marginTop:"10px"},et={...me,marginTop:"-10px"},jt=()=>{const[c,j]=_.useState([{value:"",label:""}]),{translate:t}=De(),{register:l,setValue:y,handleSubmit:b,reset:k,watch:a,control:de,formState:{errors:u}}=qe(),{state:d}=be(),{origin:n,destination:i,trip_type:E,passengerNo:P,distance:w,duration:h,bagsNo:$,departureDate:T,departureHour:F,returnHours:ue,returnDate:he}=(d==null?void 0:d.order)||{},{data:H,isLoading:D}=Pe({queryKey:["countries"],queryFn:async()=>(await R.get("countries/getCountries")).data}),pe=Se(),xe=Ce();let g=a("countryId");const fe=re({mutationFn:async s=>(await R.post("email/send/confirmation",s,{headers:{resendapikey:Ie}})).data}),je=async s=>{var ee,te,se,ae,ne;const o={num:t("order_number"),origen:t("origin2"),destino:t("destination2"),dateTime:t("dateTime"),total:t("total")},U={...o,preview:t("newReservation"),header:t("newReservationMessage")},C={...o,preview:t("reservationConfirmation"),header:t("thankYouMessage")},G=I((ee=s==null?void 0:s.origin)==null?void 0:ee.formatted_address," Dominican Republic",` ${t("do")}`),J=I((te=s==null?void 0:s.destination)==null?void 0:te.formatted_address," Dominican Republic",` ${t("do")}`),X=oe(F),Z=z==="es"?A:K,_e=await le(e.jsx(ce,{parameters:{name:(se=s==null?void 0:s.customer)==null?void 0:se.name,reservationNum:s==null?void 0:s.order_num,origin:G,destination:J,date:Z,hour:X,total:v(s==null?void 0:s.total)},labels:U}),{pretty:!0}),ve=await le(e.jsx(ce,{parameters:{name:(ae=s==null?void 0:s.customer)==null?void 0:ae.name,reservationNum:s==null?void 0:s.order_num,origin:G.replace(/\d/g,""),destination:J.replace(/\d/g,""),date:Z,hour:X,total:v(s==null?void 0:s.total)},labels:C}),{pretty:!0}),Ne={email:(ne=s==null?void 0:s.customer)==null?void 0:ne.email,subject:[t("reservationConfirmation"),t("thankYouMessage")],html:[_e,ve]};fe.mutate(Ne)},q=re({mutationFn:async s=>await Ue.createOrder(s),onSuccess:({orderCreated:s})=>{pe.invalidateQueries({queryKey:["orders"]}),je(s),xe("/order/confirmation",{state:{orderCreated:s}}),y("name",""),g={value:"",label:""},k()},onError:()=>{m("error",t("order_creation_error"))}}),{setVehicle:B,setTotal:V,paymentMethod:M,setPaymentMethod:L,total:S,vehicle:r}=we(),O=async s=>{const o={name:s.name,lastName:s.lastName,email:s.email,phone:s.phone,optionalPhone:s.optionalPhone,formatted_origin_address:n==null?void 0:n.formatted_address,formatted_destination_address:i==null?void 0:i.formatted_address,origin_lng:n==null?void 0:n.lng,destination_lng:i==null?void 0:i.lng,origin_lat:n==null?void 0:n.lat,destination_lat:i==null?void 0:i.lat,trip_type:E,passengers:P,luggage:$,departureDate:T,departureHours:F,returnHours:ue,returnDate:he,countryId:s.countryId.value,distance:w==null?void 0:w.text,duration:h==null?void 0:h.text,vehicleId:r==null?void 0:r.id,airline:s.airline,flight_number:s.flight_number,additionalNotes:s.additionalNotes,paymentMethod:M,total:S};q.mutate(o)},Q=(s,o)=>{const C=s.currentTarget.value.replace(/\D/g,"");s.currentTarget.value=C,y(o,C,{shouldValidate:!0})},W=s=>{s.name?m("error",t("complete_first_name")):s.lastName?m("error",t("complete_last_name")):s.email?m("error",t("complete_email")):s.phone?m("error",t("complete_phone")):s.countryId||!g?m("error",t("select_country")):s.airline?m("error",t("complete_airline")):s.flight_number?m("error",t("complete_flight")):s.additionalNotes&&m("error",t("complete_comments"))},Y=new Date,{idiom:z}=Be(),A=ie(T??Y,"d 'de' MMMM 'de' yyyy",{locale:Fe}),K=ie(T??Y,"MMMM d, yyyy",{locale:He}),ye=_.useRef(null);if(_.useEffect(()=>{const s=document.getElementById("main");s&&s.scrollIntoView()},[]),_.useEffect(()=>{d&&(B(d.vehicle),V(d.total))},[d,B,V]),_.useEffect(()=>{!D&&H&&j(H.map(s=>({value:s.country_id,label:s.country})))},[D,H]),!d)return e.jsx(ke,{text:t("reservation_steps_error"),redirectTo:"/#booking"});const ge=()=>{b(O,W)()};return e.jsxs(Ae.div,{className:"checkout",initial:{opacity:0},animate:{opacity:1},transition:{type:"spring",duration:.3},ref:ye,children:[e.jsx(Re,{}),e.jsxs("div",{className:"wrapper",children:[e.jsxs("div",{className:"top",style:{display:"flex"},children:[e.jsxs("div",{className:"left",children:[e.jsx("h2",{id:"checkout",children:t("billing_details")}),e.jsxs("form",{action:"",onSubmit:b(O,W),className:"checkout-form",children:[e.jsxs("div",{className:"item customer",children:[e.jsxs("div",{className:"form-item",children:[e.jsx("label",{htmlFor:"name",children:t("first_name")}),e.jsx("input",{id:"name",type:"text",placeholder:t("first_name"),className:`forminput ${u.name?"invalid":""}`,...l("name",{required:!0})})]}),e.jsxs("div",{className:"form-item",children:[e.jsx("label",{htmlFor:"last_name",children:t("last_name")}),e.jsx("input",{id:"last_name",type:"text",placeholder:t("last_name"),className:`forminput ${u.lastName?"invalid":""}`,...l("lastName",{required:!0})})]})]}),e.jsxs("div",{className:"item",children:[e.jsx("label",{htmlFor:"email",children:t("email")}),e.jsx("input",{type:"email",placeholder:t("email"),className:`forminput ${u.email?"invalid":""}`,...l("email",{required:!0})})]}),e.jsxs("div",{className:"item",children:[e.jsx("label",{children:t("phone_number")}),e.jsx("input",{type:"text",placeholder:t("phone_number"),className:`forminput ${u.phone?"invalid":""}`,...l("phone",{required:!0}),onInput:s=>Q(s,"phone")})]}),e.jsxs("div",{className:"item",children:[e.jsx("label",{htmlFor:"phone",children:t("additional_phone_number")}),e.jsx("input",{type:"text",className:"forminput",placeholder:t("additional_phone_number"),...l("optionalPhone",{required:!1}),onInput:s=>Q(s,"optionalPhone")})]}),e.jsxs("div",{className:"item",children:[e.jsx("label",{htmlFor:"country",children:t("country")}),e.jsx(Me,{name:"countryId",control:de,rules:{required:"Country is required"},render:({fieldState:s})=>e.jsx(Te,{options:c,isSearchable:!0,customStyles:s.error&&{borderColor:"Red"},placeholder:t("select_country"),onChange:o=>{y("countryId",o,{shouldValidate:!0})},value:c.find(o=>o.value===(g==null?void 0:g.value))})})]}),e.jsxs("div",{className:"item customer",children:[e.jsxs("div",{className:"form-item",children:[e.jsx("label",{htmlFor:"airline",children:t("airline")}),e.jsx("input",{className:`forminput ${u.airline?"invalid":""}`,type:"text",placeholder:t("airline"),...l("airline",{required:!0})})]}),e.jsxs("div",{className:"form-item",children:[e.jsx("label",{htmlFor:"flight_number",children:t("flight_number")}),e.jsx("input",{className:`forminput ${u.flight_number?"invalid":""}`,type:"text",placeholder:t("flight_number"),...l("flight_number",{required:!0})})]})]}),e.jsxs("div",{className:"item",children:[e.jsx("label",{htmlFor:"comments",children:t("comments")}),e.jsx("textarea",{rows:10,className:`forminput ${u.additionalNotes?"invalid":""}`,placeholder:t("comments"),...l("additionalNotes",{required:!0})})]})]})]}),e.jsxs("div",{className:"right",children:[e.jsx("h2",{children:t("additional_info")}),e.jsxs("div",{className:"additional-info",children:[e.jsxs("div",{className:"item",children:[e.jsxs("strong",{children:[t("origin_address"),":"]}),e.jsx("span",{children:I(n==null?void 0:n.formatted_address.replace(/\d/g,"")," Dominican Republic",` ${t("do")}`)})]}),e.jsxs("div",{className:"item",children:[e.jsxs("strong",{children:[t("destination_address"),":"]}),e.jsx("span",{children:I(i==null?void 0:i.formatted_address.replace(/\d/g,"")," Dominican Republic",` ${t("do")}`)})]}),e.jsxs("div",{className:"item",children:[e.jsxs("strong",{children:[t("trip_type"),":"]}),e.jsx("span",{children:t(E===1?"one_way":"round_trip")})]}),e.jsxs("div",{className:"item",children:[e.jsxs("strong",{children:[t("departure_date_time"),":"]}),e.jsxs("span",{children:[oe(F)," -",z==="es"?A:K]})]}),e.jsxs("div",{className:"item",children:[e.jsxs("strong",{children:[t("travel_duration"),":"]}),e.jsx("span",{children:h!=null&&h.text?h.text:"---"})]}),e.jsxs("div",{className:"item",children:[e.jsxs("strong",{children:[t("vehicle"),":"]}),e.jsxs("span",{children:[r==null?void 0:r.brand," ",r==null?void 0:r.model," de ",r==null?void 0:r.capacity,"Â ",t("people")]})]}),e.jsxs("div",{className:"item",children:[e.jsxs("strong",{children:[t("num_passengers"),":"]}),e.jsx("span",{children:P})]}),e.jsxs("div",{className:"item",children:[e.jsxs("strong",{children:[t("num_bags"),":"]}),e.jsx("span",{children:$})]})]})]})]}),e.jsxs("div",{className:"bottom",children:[e.jsx("h1",{children:t("reservation")}),e.jsx(Ee,{columns:[t("trip"),t("subtotal")],data:[{accesor:t(E===1?"one_way":"round_trip"),total:v(S),key:"accesor",value:"total"},{accesor:"Subtotal",total:v(S),key:"accesor",value:"total"},{accesor:"Total",total:v(S),key:"accesor",value:"total"}]}),e.jsxs("div",{className:"payment-method",children:[e.jsxs("label",{className:"payment-item",children:[t("cash"),e.jsx("input",{type:"radio",id:"Cash",checked:M==="Cash",onChange:()=>{L("Cash")}}),e.jsx("span",{className:"radio-label"})]}),e.jsxs("label",{className:"payment-item",children:[t("card"),e.jsx("input",{type:"radio",id:"card",checked:M==="Card",onChange:()=>{L("Card")}}),e.jsx("span",{className:"radio-label"})]}),e.jsxs("div",{className:"about-card-payment",children:[e.jsx("span",{className:"clippy"}),e.jsx("span",{className:"advice",children:t("card_payment_note")})]}),e.jsx($e,{properties:{type:"secondary",onClickfn:()=>{ge()},disabled:q.isLoading},children:q.isLoading?t("reserving"):t("schedule_reservation")})]})]})]})]})};export{jt as default};
