import{r as u,j as e,b,f as I,c as $}from"./index-CJpT4Mpi.js";import{B as _}from"./Button-CWgbnBvx.js";import{u as B}from"./index.esm-CfSZGkEr.js";import{u as E}from"./useMutation-C7nlVA5o.js";import{c as r,I as A}from"./customToast-DW0GGLWY.js";import{u as F}from"./Translate-Bz6qGM8U.js";import{u as T,P as R,T as K}from"./Pagination-4_R8EG9X.js";import{m as P}from"./proxy-BgVQIM8n.js";import{u as Q}from"./useQuery-BWJx_JCY.js";import{L as W}from"./Loader-Dqsd4B3d.js";import{C as z}from"./ConfirmPopup-D7lvN5wv.js";import{A as D}from"./index-DCUZ38Ht.js";import"./es-D9rJmWfh.js";import"./react-DzjR_lZ5.js";const O=({properties:N})=>{const{setShow:p,editMode:c,vehicle_admin:a}=T(),{queryClient:v}=N,{register:o,handleSubmit:j,reset:y,setValue:h,formState:{errors:l}}=B(),{translate:i}=F(),[d,m]=u.useState(null),S=async t=>{const s=t[0];if(s){if(!["image/png","image/jpeg","image/webp"].includes(s.type)){r("warning",i("invalid_format"));return}if(s.size>5*1024*1024){r("warning",i("file_too_large"));return}m(s)}},g=t=>{t.preventDefault(),m(null)},L=E({mutationFn:async t=>await b.post("vehicle/createVehicle",t,{headers:{"Content-Type":"multipart/form-data"}}),onSuccess:()=>{v.invalidateQueries({queryKey:["vehicles_admin"]}),r("success",i("vehicle_created_successfully")),m(null),y(),p(!1)},onError:()=>{r("error",i("vehicle_creation_error"))}}),w=E({mutationFn:async t=>(await b.put("vehicle/updateVehicle/"+(a==null?void 0:a.id),t)).data,onSuccess:()=>{v.invalidateQueries({queryKey:["vehicles_admin"]}),r("success",i("vehicle_updated_successfully")),m(null),y(),p(!1)},onError:()=>{r("error",i("vehicle_update_error"))}}),n=async t=>{const s=new FormData;s.append("image",t.img_url[0]),s.append("brand",t.brand),s.append("model",t.model),s.append("capacity",t.capacity.toString()),s.append("luggage_capacity",t.luggage_capacity.toString()),s.append("price_per_km",t.price_per_km.toString()),c?w.mutate(s):L.mutate(s)},f=(t,s)=>{const k=t.currentTarget.value,q=s=="price_per_km"?/[^\d.]/g:/\D/g,C=k.replace(q,"");t.currentTarget.value=C,h(s,C,{shouldValidate:!0})},M=t=>{t.img_url?r("error",i("select_image")):t.brand?r("error",i("complete_brand_field")):t.model?r("error",i("complete_model_field")):t.capacity?r("error",i("complete_capacity_field")):t.luggage_capacity?r("error",i("complete_cargo_capacity_field")):t.price_per_km&&r("error",i("complete_price_per_km_field"))};u.useEffect(()=>{a&&c&&Object.keys(a).forEach(t=>{const s=t;h(s,a[s].toString())})},[c,a,h]);const V=()=>{if(c)return d?e.jsxs("div",{className:"foto",children:[e.jsx("img",{src:URL.createObjectURL(d),alt:"Previsualización de la imagen"}),e.jsx("button",{onClick:g,children:"X"})]}):e.jsxs("div",{className:"foto",children:[e.jsx("img",{src:I+"/"+(a==null?void 0:a.img_url),alt:"Previsualización de la imagen"}),e.jsx("button",{onClick:g,style:{display:c?"none":""},children:"X"})]});if(d)return e.jsxs("div",{className:"foto",children:[e.jsx("img",{src:URL.createObjectURL(d),alt:"Previsualización de la imagen"}),e.jsx("button",{onClick:g,children:"X"})]});if(d==null)return e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-image-up",children:[e.jsx("path",{d:"M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21"}),e.jsx("path",{d:"m14 19.5 3-3 3 3"}),e.jsx("path",{d:"M17 22v-5.5"}),e.jsx("circle",{cx:"9",cy:"9",r:"2"})]}),e.jsx("span",{children:i("upload_image")})]})};return e.jsx(P.div,{className:"admin_vehicles_modal",initial:{opacity:.5},animate:{opacity:1},transition:{duration:.2},exit:{opacity:.5},children:e.jsxs(P.div,{initial:{scale:0},animate:{scale:1},transition:{scale:.3},exit:{scale:0},className:"modal_container",children:[e.jsxs("div",{className:"title",children:[e.jsx("h2",{children:i("new_vehicle")}),e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-circle-x",onClick:()=>p(!1),children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"m15 9-6 6"}),e.jsx("path",{d:"m9 9 6 6"})]})]}),e.jsxs("form",{action:"",className:"vehicle_form",onSubmit:j(n,M),encType:"multipart/form-data",children:[e.jsxs("label",{htmlFor:"img_file",className:`upload ${l.img_url?"invalid":""}`,children:[V(),e.jsx("input",{id:"img_file",type:"file",className:"img_input",accept:"image/png, image/jpeg, image/webp",...o("img_url",{required:!c,onChange:t=>{S(t.target.files)}})})]}),e.jsx("input",{type:"text",placeholder:i("brand"),className:`${l.brand?"invalid":""}`,...o("brand",{required:!0})}),e.jsx("input",{type:"text",placeholder:i("model"),className:`${l.model?"invalid":""}`,...o("model",{required:!0})}),e.jsx("input",{type:"text",placeholder:i("capacity_persons"),inputMode:"numeric",className:`${l.capacity?"invalid":""}`,...o("capacity",{required:!0}),onInput:t=>f(t,"capacity")}),e.jsx("input",{type:"text",placeholder:i("luggage_capacity"),inputMode:"numeric",className:`${l.luggage_capacity?"invalid":""}`,...o("luggage_capacity",{required:!0}),onInput:t=>f(t,"luggage_capacity")}),e.jsx("input",{type:"text",placeholder:i("price_per_km"),inputMode:"numeric",className:`${l.price_per_km?"invalid":""}`,...o("price_per_km",{required:!0}),onInput:t=>f(t,"price_per_km")}),e.jsx(_,{properties:{type:"primary",onClickfn:()=>{}},children:e.jsx("span",{children:i(c?"modify":"save")})})]})]})})},ne=()=>{const{confirm:N,setConfirm:p,show:c,setShow:a,setEditMode:v,setVehicleId:o,vehicleId:j}=T(),[y,h]=u.useState(0),[l,i]=u.useState("all"),[d,m]=u.useState(1),[S,g]=u.useState(!0),L=5,w=$(),{translate:n}=F(),{data:f,isLoading:M,error:V,refetch:t}=Q({queryKey:["vehicles_admin"],queryFn:async()=>{const x=await b.get("vehicle/getAllVehicles",{params:{status:l,skip:d,limit:L}});return g(x.data.hasNextPage),h(x.data.totalPages),x.data.vehicle}}),s=E({mutationFn:async x=>{await b.delete("vehicle/deleteVehicle/"+x)},onSuccess:()=>{w.invalidateQueries({queryKey:["vehicles_admin"]}),r("success",n("vehicle_deleted_successfully")),o(""),p(!1)},onError:()=>{r("error",n("error_deleting_vehicle"))}}),k=u.useMemo(()=>[{column:"Imagen",key:"img_url"},{column:"Marca",key:"brand"},{column:"Capacidad",key:"capacity"},{column:"Luggage",key:"luggage_capacity"},{column:"price",key:"price_per_km"},{column:"status",key:"status"},{column:"",key:"button"}],[]),q=()=>{if(!j)return r("error",n("vehicle_not_found"));s.mutate(j)},C=()=>V?e.jsx("div",{children:n("something_went_wrong")}):M?e.jsx(W,{}):e.jsx(K,{headers:k,data:f,isOrder:!1});return u.useEffect(()=>{t()},[l,d,t]),e.jsxs("div",{className:"admin_vehicle",children:[e.jsx(A,{}),e.jsx(D,{children:c&&e.jsx(O,{properties:{queryClient:w}})}),e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"warn_mobile",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-triangle-alert",children:[e.jsx("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}),e.jsx("path",{d:"M12 9v4"}),e.jsx("path",{d:"M12 17h.01"})]}),e.jsx("span",{className:"",children:n("only_remove_unoccupied_vehicles")})]}),e.jsxs("div",{className:"filter",children:[e.jsx(_,{properties:{type:"filter",onClickfn:()=>{i("all")},btnClass:`${l=="all"?"selected":""}`},children:n("all")}),e.jsx(_,{properties:{type:"filter",onClickfn:()=>{i("1")},btnClass:`${l==="1"?"selected":""}`},children:n("available")}),e.jsx(_,{properties:{type:"filter",onClickfn:()=>{i("0")},btnClass:`${l==="0"?"selected":""}`},children:n("occupied")}),e.jsxs("div",{className:"warn",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-triangle-alert",children:[e.jsx("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}),e.jsx("path",{d:"M12 9v4"}),e.jsx("path",{d:"M12 17h.01"})]}),e.jsx("span",{className:"",children:n("only_remove_unoccupied_vehicles")})]})]}),e.jsxs(_,{properties:{type:"options",onClickfn:()=>{a(!0),v(!1)}},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"btn_icon",children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5v14"})]}),n("add_vehicle")]})]}),C(),e.jsx(R,{pageCount:y,skip:d,setSkip:m,hasNextPage:S}),N&&e.jsx(z,{title:"Borrar vehiculo",subTitle:"Este vehiculo sera eliminado completamente ¿Seguro que deseas continuar? ",onConfirm:q,onCancel:()=>{o(""),p(!1)}})]})};export{ne as default};
